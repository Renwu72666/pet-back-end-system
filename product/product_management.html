<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>寵物廚房</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- ================== 圖示設定 ================== -->
    <link rel="icon" type="image/png" href="../images/icon/icon_images.png" />

    <!-- ================== CSS 基本樣式 ================== -->
    <link href="../css/basic/fonts.googleapis.css" rel="stylesheet" />
    <link href="../css/basic/jquery-ui.min.css" rel="stylesheet" />
    <link href="../css/basic/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../css/basic/animate.min.css" rel="stylesheet" />
    <link href="../css/basic/style.min.css" rel="stylesheet" />
    <link href="../css/basic/style-responsive.min.css" rel="stylesheet" />
    <link href="../css/basic/default.css" rel="stylesheet" />
    <link href="../css/basic/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <!-- ================== CSS Table樣式 ================== -->
    <link href="../css/tableTools/data-table.css" rel="stylesheet" />  
    <!-- ================== CSS notify樣式 ================== -->
    <link href="../css/notify/notyf.min.css" rel="stylesheet" /> 
    <!-- ================== CSS bootstrap-select樣式 ================== -->
    <link href="../css/bootstrap-select/bootstrap-select.min.css" rel="stylesheet" />
    <!-- ================== CSS parsley樣式 ================== -->
    <link href="../css/parsley/parsley.css" rel="stylesheet" />
    <!-- ================== CSS ssi-uploader樣式 ================== -->
    <link href="../css/ssi-uploader/ssi-uploader.min.css" rel="stylesheet" />
    <!-- ================== JS ckeditor控制 ================== -->
    <script src="../ckeditor/ckeditor.js"></script>
    <!-- ================== CSS sweetalert2 ================== -->
    <link href="../css/sweetalert2/sweetalert2.min.css" rel="stylesheet" />
</head>
<body>
    <!-- 頁面loader開始 -->
    <div id="page-loader" class="fade in"><span class="spinner"></span></div>
    <!-- 頁面loader結束 -->
    <!-- 整頁內容開始 -->
    <div id="page-container" class="fade page-sidebar-fixed page-header-fixed">
        <!-- header開始 -->
        <div id="header" class="header navbar navbar-default navbar-fixed-top">
            <!-- 上方title_bar開始 -->
            <div class="container-fluid">
                <!-- title_bar 內文開始 -->
                <div class="navbar-header">
                    <a href="../index.html" class="navbar-brand"><span class="navbar-logo"></span> 寵物廚房管理系統</a>
                    <button type="button" class="navbar-toggle" data-click="sidebar-toggled">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <!-- title_bar 內文結束 -->
                <!-- 登出與搜尋功能開始 -->
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown navbar-user">
                        <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown">
                            <img src="../images/user/farmer.png" alt="" />
                            <span class="hidden-xs">使用者名稱</span> <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu animated fadeInLeft">
                            <li><a href="javascript:;">登出</a></li>
                        </ul>
                    </li>
                </ul>
                <!-- 登出與搜尋功能結束 -->
            </div>
            <!-- 上方title_bar結束 -->
        </div>
        <!-- header結束 -->
        <!-- sidebar開始 -->
        <div id="sidebar" class="sidebar">
            <!-- 滑動側欄開始 -->
            <div data-scrollbar="true" data-height="100%">
                <!-- sidebar user開始  -->
                <ul class="nav">
                    <li class="nav-profile">
                        <div class="image">
                            <a href="javascript:;"><img src="../images/user/farmer.png" alt="" /></a>
                        </div>
                        <div class="info">
                            放使用者名稱
                            <small>放介紹</small>
                        </div>
                    </li>
                </ul>
                <!-- sidebar user結束 -->
                <!-- 選單項目功能開始 -->
                <ul class="nav">
                    <li class="nav-header">功能選單</li>
                    <li class="has-sub">
                        <a href="../index.html">
                            <i class="fa fa-laptop"></i>
                            <span>首頁</span>
                        </a>
                    </li>
                    <li class="has-sub">
                        <a href="javascript:;">
                            <b class="caret pull-right"></b>
                            <i class="fa fa-user"></i>
                            <span>會員管理</span>
                        </a>
                        <ul class="sub-menu">
                            <li><a href="../member/member_administration.html">會員基本資料</a></li>
                            <li><a href="../member/member_freeze.html">會員凍結資料</a></li>
                        </ul>
                    </li>
                    <li class="has-sub active">
                        <a href="javascript:;">
                            <b class="caret pull-right"></b>
                            <i class="fa fa-shopping-cart"></i>
                            <span>商品管理</span>
                        </a>
                        <ul class="sub-menu">
                            <li class="active"><a href="../product/product_management.html">商品資料</a></li>
                            <li class="has-sub">
                                <a href="javascript:;"><b class="caret pull-right"></b>客製化商品</a>
                                <ul class="sub-menu">
                                    <li><a href="../product/customized_category.html">原料規格細節</a></li>
                                    <li><a href="../product/customized_standard.html">一般飼料規格</a></li>
                                    <li><a href="../product/customized_materil.html">原料來源</a></li>
                                </ul>
                            </li>
                            <li><a href="../product/product_ofstock.html">已下架商品</a></li>
                            <li><a href="../product/product_increase.html">新增商品</a></li>
                        </ul>
                    </li>
                    <li class="has-sub">
                        <a href="javascript:;">
                            <b class="caret pull-right"></b>
                            <i class="fa fa-building"></i>
                            <span>訂單管理</span>
                        </a>
                        <ul class="sub-menu">
                            <li><a href="">訂單總覽</a></li>
                            <li><a href="">退換貨總覽</a></li>
                        </ul>
                    </li>
                    <li class="has-sub">
                        <a href="javascript:;">
                            <b class="caret pull-right"></b>
                            <i class="fa fa-newspaper-o"></i>
                            <span>公告管理</span>
                        </a>
                        <ul class="sub-menu">
                            <li><a href="../bulletin/bulletin_management.html">公告列表</a></li>
                            <li><a href="../bulletin/bulletin_increase.html">新增公告</a></li>
                        </ul>
                    </li>
                    <li class="has-sub">
                        <a href="javascript:;">
                            <b class="caret pull-right"></b>
                            <i class="fa fa-phone"></i>
                            <span>客服管理</span>
                        </a>
                        <ul class="sub-menu">
                            <li><a href="../service/customer_noreply.html">未回覆諮詢</a></li>
                            <li><a href="../service/customer_service.html">已回覆諮詢</a></li>

                        </ul>
                    </li>
                    <li class="has-sub">
                        <a href="javascript:;">
                            <b class="caret pull-right"></b>
                            <i class="fa fa-bank (alias)"></i>
                            <span>生產管理</span>
                        </a>
                        <ul class="sub-menu">
                            <li><a href="../produce/production-report.html">未製作訂單</a></li>
                            <li><a href="../produce/production-report.html">訂單報表查詢</a></li>

                        </ul>
                    </li>
                    <li class="has-sub">
                        <a href="javascript:;">
                            <b class="caret pull-right"></b>
                            <i class="fa fa-gears (alias)"></i>
                            <span>後台管理</span>
                        </a>
                        <ul class="sub-menu">
                            <li><a href="../backstage/backstage_management.html">管理者</a></li>
                            <li><a href="../backstage/administrator.html">新增管理者</a></li>
                        </ul>
                    </li>
                    <!-- begin sidebar minify button -->
                    <li><a href="javascript:;" class="sidebar-minify-btn" data-click="sidebar-minify"><i class="fa fa-angle-double-left"></i></a></li>
                    <!-- end sidebar minify button -->
                </ul>
                <!-- 選單項目功能結束 -->
            </div>
            <!-- 滑動側欄結束 -->
        </div>
        <div class="sidebar-bg"></div>
        <!-- sidebar結束 -->
        <!-- 中間內文開始 -->
        <div id="content" class="content">
            <!-- 瀏覽導航開始 -->
            <ol class="breadcrumb pull-right">
                <li><a href="javascript:;">Home</a></li>
                <li><a href="javascript:;">Page</a></li>
                <li>Page</li>
            </ol>
            <!-- 瀏覽導航結束 -->
            <!-- begin page-header -->
            <h1 class="page-header">商品資料管理 <small>商品檢視與修改</small></h1>
            <!-- end page-header -->
            <div class="panel panel-inverse">
                <div class="panel-heading">
                    <div class="panel-heading-btn">
                        <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                        <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" data-click="panel-reload"><i class="fa fa-repeat"></i></a>
                        <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                        <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger" data-click="panel-remove"><i class="fa fa-times"></i></a>
                    </div>
                    <h4 class="panel-title">商品資料清單</h4>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table id="data-table" class="table table-striped table-bordered nowrap" width="100%">
                            <thead>
                                <tr>
                                    <th>商品編號</th>
                                    <th>分類</th>
                                    <th>名稱</th>
                                    <th>單價</th>
                                    <th>庫存</th>
                                    <th>最後修改人</th>
                              
                                </tr>
                            </thead>
                            <tbody id="product-view">
                          
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- 中間內文結束 -->
        <!-- footer開始 -->
        <div id="footer" class="footer">
            &copy; 2017 龔旭陽教授實驗室開發 
        </div>
        <!-- footer結束 -->
        <!-- 置頂按鈕開始 -->
        <a href="javascript:;" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top"><i class="fa fa-angle-up"></i></a>
        <!-- 置頂按鈕結束 -->
    </div>
    <!-- 整頁內容結束 -->
    <!-- 彈跳視窗開始  -->
    <div class="modal fade" id="jump-product" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">商品修改</h4>
                </div>
                <div class="modal-body">
                    <div class="panel-body">
                        <div class="panel-body panel-form">
                            <form class="form-horizontal form-bordered" data-parsley-validate="true" name="demo-form" id="product_modify" >
                                <div class="form-group">
                                    <label class="control-label col-md-2 col-sm-2" for="fullname">商品狀態 :</label>
                                    <div class="col-md-4 col-md-4">
                                        <input type="button" class="btn btn-primary" id="Off-shelf" value="下架" />
                                    </div>
                                    <label class="control-label col-md-1 col-sm-1" for="fullname">商品編號 :</label>
                                    <div class="col-md-4 col-md-4">
                                        <label class="control-label col-md-2 col-sm-2" id="product_id" for="fullname"></label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-2 col-sm-2" for="fullname">商品名稱 :</label>
                                    <div class="col-md-4 col-md-4">
                                        <input class="form-control" type="text" id="product-name" data-parsley-required="true" />
                                    </div>
                                    <label class="control-label col-md-2 col-sm-2" for="fullname">商品分類 :</label>
                                    <div class="col-md-4 col-md-4">
                                        <div class="col-md-8">
                                            <select class="form-control selectpicker" data-size="5" name="product-classification" id="product-classification" data-style="btn-inverse"><!--data-live-search="true" 可搜尋-->
                                                <option value="保健品">保健品</option>
                                                <option value="零食">零食</option>
                                                <option value="鮮食">鮮食</option>
                                                <option value="玩具">玩具</option>
                                                <option value="其他">其他</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-2 col-sm-2" for="fullname">商品價錢 :</label>
                                    <div class="col-md-4 col-md-4">
                                        <input class="form-control" type="number" name="points" id="product-price" min="1" data-parsley-required="true" onkeyup="value=value.replace(/[^\d]/g,'')"/>
                                    </div>
                                    <label class="control-label col-md-2 col-sm-2" for="fullname">商品數量 :</label>
                                    <div class="col-md-4 col-md-4">
                                        <input class="form-control"  type="number" id="product-num" name="points" min="1" data-parsley-required="true" onkeyup="value=value.replace(/[^\d]/g,'')" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-2 col-sm-2" for="fullname">說明 :</label>
                                    <div class="col-md-10 col-sm-10">
                                        <!--<textarea class="form-control" name="product_deatil" rows="4" data-parsley-range="[10,200]" placeholder="請輸入 10 - 200 字之間" data-parsley-required="true"></textarea>-->
                                        <textarea class="form-control" name="product_message" id="product_message" rows="10" cols="80"></textarea>
                                        <script>
                                            CKEDITOR.replace('product_message', { filebrowserImageUploadUrl: '~/ckfinder/userfiles/images/' });
                                        </script>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-2 col-sm-2" for="fullname">圖片 :</label>
                                    <div class="col-md-2 col-md-2">
                                        <img src="../images/icon/icon_images.png" id="product-img" style="width:100px;height:100px" />
                                    </div>    
                                    <div class="col-md-4 col-md-4">
                                        <h5>上傳修改圖片</h5>
                                        <input type="file" id="ssi_upload" name="ssi_upload" />
                                    </div>     
                                    <label class="control-label col-md-2 col-sm-2" for="fullname">圖片說明 :</label>
                                    <div class="col-md-4 col-sm-4">
                                        <textarea class="form-control" name="message" id="product-img-message" rows="4" data-parsley-range="[20,200]" placeholder="請輸入 20 - 100 字之間"></textarea>
                                    </div>                             
                                </div>
                                <div class="modal-footer">
                                    <input type="button" class="btn btn-secondary" data-dismiss="modal" value="取消" />
                                    <input type="submit" class="btn btn-primary" id="product_update" value="修改" />
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
               
            </div>
        </div>
    </div>
    <!-- 彈跳視窗結束  -->

    <!-- ================== JS 基本控制 ================== -->
    <script src="../javascript/basic/jquery-1.12.4.min.js"></script>
    <script src="../javascript/basic/bootstrap/bootstrap.min.js"></script>
    <script src="../javascript/basic/jquery-migrate-1.1.0.min.js"></script>
    <script src="../javascript/basic/jquery-ui.min.js"></script>
    <script src="../javascript/basic/jquery.slimscroll.min.js"></script>
    <script src="../javascript/page_controll/pace.min.js"></script>
    <!-- ================== JS 擴充控制 ================== -->
    <script src="../javascript/tableTools/table-manage-tabletools.demo.min.js"></script>
    <script src="../javascript/tableTools/jquery.dataTables.js"></script>
    <script src="../javascript/tableTools/dataTables.tableTools.js"></script>
    <script src="../javascript/page_controll/apps.min.js"></script> 
    <!-- ================== JS notify控制 ================== -->
    <script src="../javascript/notify/notyf.min.js"></script>   
    <!-- ================== JS bootstrap-select控制 ================== -->
    <script src="../javascript/bootstrap-select/bootstrap-select.min.js"></script>
    <!-- ================== JS parsley控制 ================== -->
    <script src="../javascript/parsley/parsley.js"></script>
    <!-- ================== JS ssi-uploader控制 ================== -->
    <script src="../javascript/ssi-uploader/ssi-uploader.min.js"></script>
    <!-- ================== JS cookie ================== -->
    <script src="../javascript/cookie/js.cookie-2.1.3.min.js"></script>
    <!-- ================== JS sweetalert2 ================== -->
    <script src="../javascript/sweetalert2/sweetalert2.min.js"></script>
    <script>
		$(document).ready(function() {
		    App.init();
		    TableManageTableTools.init();
		    $('#ssi_upload').ssi_uploader({ maxFileSize: 6, maxNumberOfFiles: 1, allowed: ['jpg', 'bmp', 'png', 'jpge'] });
		});

    </script>
    <script>
        var notyf = new Notyf();//notyf.js宣告使用
        /**表格載入資料**/
        $.ajax({
            url: 'http://petapi.uchef.com.tw/Product/ProductSummary',
            type: 'get',
            dataType: 'json',
            data:{product_status : "上架"},
            async: false,//啟用同步請求
            success: function (Product_Json) {
                var cssString = "";
                for (var index in Product_Json) {
                    cssString += '<tr data-toggle="modal" data-target="#jump-product"  data-id="' + Product_Json[index].product_id + '">' +
                        '<td>' + Product_Json[index].product_id + '</td>' +
                        '<td>' + Product_Json[index].product_item + '</td>' +
                        '<td>' + Product_Json[index].product_name + '</td>'+
                        '<td>' + Product_Json[index].product_price + '</td>'+
                        '<td>' + Product_Json[index].product_number + '</td>'+
                        '<td>' + Product_Json[index].last_alter_name + '</td>'
                    cssString += '</tr>'
                }
                $("#product-view").html(cssString);
            },
            error: function (e) {
                notyf.alert('伺服器錯誤,無法載入');
            }
        });

        /**bootstrap modal 載入資料**/
        $('#jump-product').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) //觸發按鈕
            var recipient = button.data('id') // 取得data-id attributes 的id值
            $("#product_id").text(recipient);
            /**顯示modal商品資料**/
            $.ajax({
                url: 'http://petapi.uchef.com.tw/Product/ProductDetails?id=' + recipient,
                type: 'get',
                dataType: 'json',
                async: false,//啟用同步請求
                success: function (ProductInformation_Json) {
                    for (var index in ProductInformation_Json) {
                        $("#product-name").val(ProductInformation_Json.product_name);
                        //$("#product-classification").val(ProductInformation_Json[index].product_item);
                        $('.bootstrap-select .filter-option').text(ProductInformation_Json.product_item);//顯示 selected
                        $('select[name=product-classification]').val(ProductInformation_Json.product_item);//selected 項目
                        $("#product-price").val(ProductInformation_Json.product_price);
                        $("#product-num").val(ProductInformation_Json.product_number);
                        //$("#product-message").val(ProductInformation_Json[index].product_deatil);
                        CKEDITOR.instances["product_message"].setData(ProductInformation_Json.product_deatil)
                        $("#product-img-message").val(ProductInformation_Json.product_img_detail);
                        $("#product-img").attr("src", ProductInformation_Json.product_img);
                    }
                },
                error: function (e) {
                    notyf.alert('伺服器錯誤,無法載入');
                }
            });
            /**商品修改**/            
            var imagesrc=''
            $("#product_update").click(function (event) {
                event.preventDefault();
                var splits = base64vaule.split(",")                
                if (htmlname != '') {//有改圖片
                    $.ajax({
                        url: 'http://petapi.uchef.com.tw/UploadImage',
                        headers: { 'Authorization': 'Bearer ' + Cookies.get('access_token') },
                        type: 'post',
                        dataType: 'json',
                        data: {
                            ImgBase64: splits[1],
                            ImgName: $("#product-name").val(),
                            pathNum: 3,
                            paths: 'Product'
                        },
                        async: false,//啟用同步請求
                        success: function (ProductImage_Json) {
                            imagesrc = ProductImage_Json.Url
                        },
                        error: function (e) {
                            notyf.alert('伺服器錯誤,無法載入');
                        }
                    });
                } else {  //沒有改圖
                    imagesrc = $("#product-img")[0].src
                }
                var data = CKEDITOR.instances.product_message.getData()
                $.ajax({
                    url: 'http://petapi.uchef.com.tw/Product/ProductModify',
                    headers: { 'Authorization': 'Bearer ' + Cookies.get('access_token') },
                    type: 'post',
                    dataType: 'json',
                    data: {
                        product_item: $("#product-classification").val(), product_name: $("#product-name").val(), product_price: $("#product-price").val(), product_number: $("#product-num").val(),
                        last_alter_name: Cookies.get('username'), product_img_detail: $("#product-img-message").val(), product_img: imagesrc, product_deatil: data, product_id: $("#product_id").text()
                    },
                    async: false,//啟用同步請求
                    success: function (ProductInsert_Json) {
                        swal({
                            type: 'success',
                            title: '新增成功!',
                            allowOutsideClick: false //不可點背景關閉
                        }).then(function () {
                            location.reload();
                        })
                    },
                    error: function (e) {
                        notyf.alert('伺服器錯誤,無法載入');
                    }
                });
            
            });
            /**下架商品**/
            $("#Off-shelf").click(function (event) {
                $.ajax({
                   url: 'http://petapi.uchef.com.tw/Product/Product_Off_shelf',
                   type: 'post',
                   dataType: 'json',
                   data: { product_id: recipient },
                   async: false,//啟用同步請求
                   headers: { 'Authorization': 'Bearer ' + Cookies.get('access_token') },
                   success: function (Off_shelf_Json) {
                       swal({
                           type: 'success',
                           title: '下架成功!',
                           html: '已添加下架此商品',
                           allowOutsideClick: false //不可點背景關閉
                       }).then(function () {
                           location.reload();
                       })
               
                   },
                   error: function (e) {
                       notyf.alert('伺服器錯誤,無法載入');
                   }
               });
            });
        })
        
    </script>

</body>
</html>
